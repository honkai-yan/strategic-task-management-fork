# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²éªŒè¯æŒ‡å—

**æ—¥æœŸ**: 2026-01-28  
**çŠ¶æ€**: ğŸŸ¡ éƒ¨åˆ†å®Œæˆï¼Œéœ€è¦æ‰‹åŠ¨æ“ä½œ  
**æµ‹è¯•å·¥ç¨‹å¸ˆ**: AI Testing Engineer

---

## å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆ
1. ä»£ç å·²æäº¤åˆ° GitHub
   - åç«¯: commit `ff09251` å’Œ `c07c869`
   - å‰ç«¯: commit `5671824` å’Œ `fbfabae`

2. åŸºç¡€æœåŠ¡æ­£å¸¸
   - å‰ç«¯ç½‘ç«™å¯è®¿é—® (200 OK)
   - åç«¯å¥åº·æ£€æŸ¥é€šè¿‡ (status: UP)
   - ç»„ç»‡ API æ­£å¸¸ (28 ä¸ªç»„ç»‡)

### âš ï¸ å¾…å®Œæˆ
1. **è€ƒæ ¸å‘¨æœŸ API ä»è¿”å› 500 é”™è¯¯**
   - åŸå› : æ–°ä»£ç å¯èƒ½è¿˜æœªéƒ¨ç½²ï¼Œæˆ–éœ€è¦é‡å¯æœåŠ¡
   - éœ€è¦: ç­‰å¾… GitHub Actions å®Œæˆæˆ–æ‰‹åŠ¨éƒ¨ç½²

2. **keyan ç”¨æˆ·ä»æ— æ³•ç™»å½•**
   - åŸå› : æ•°æ®åº“ä¿®å¤è„šæœ¬æœªæ‰§è¡Œ
   - éœ€è¦: æ‰‹åŠ¨æ‰§è¡Œæ•°æ®åº“ä¿®å¤è„šæœ¬

---

## éƒ¨ç½²éªŒè¯æ­¥éª¤

### æ­¥éª¤ 1: æ£€æŸ¥ GitHub Actions éƒ¨ç½²çŠ¶æ€

è®¿é—®ä»¥ä¸‹é“¾æ¥æ£€æŸ¥éƒ¨ç½²çŠ¶æ€ï¼š
- åç«¯: https://github.com/CDUESTC-OpenAtom-Club/sism-backend/actions
- å‰ç«¯: https://github.com/CDUESTC-OpenAtom-Club/strategic-task-management/actions

**æ£€æŸ¥é¡¹**:
- [ ] æœ€æ–°çš„ workflow run æ˜¯å¦æˆåŠŸï¼ˆç»¿è‰²å‹¾ï¼‰
- [ ] éƒ¨ç½²æ—¶é—´æ˜¯å¦åœ¨æœ€è¿‘ 10 åˆ†é’Ÿå†…
- [ ] æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—

### æ­¥éª¤ 2: éªŒè¯åç«¯éƒ¨ç½²

#### æ–¹å¼ 1: é€šè¿‡ SSH æ£€æŸ¥

```bash
# 1. SSH ç™»å½•ç”Ÿäº§æœåŠ¡å™¨
ssh user@blackevil.cn

# 2. æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
sudo systemctl status sism-backend

# 3. æ£€æŸ¥ JAR æ–‡ä»¶æ—¶é—´æˆ³
ls -lh /opt/sism/backend/sism-backend-1.0.0.jar
stat /opt/sism/backend/sism-backend-1.0.0.jar

# 4. æ£€æŸ¥æœ€è¿‘çš„æ—¥å¿—
sudo journalctl -u sism-backend -n 50 --no-pager

# 5. å¦‚æœéœ€è¦ï¼Œæ‰‹åŠ¨é‡å¯æœåŠ¡
sudo systemctl restart sism-backend
sudo systemctl status sism-backend
```

#### æ–¹å¼ 2: é€šè¿‡ API æµ‹è¯•

```bash
# æµ‹è¯•è€ƒæ ¸å‘¨æœŸ API
TOKEN=$(curl -s -X POST https://blackevil.cn/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"zhanlue","password":"123456"}' | jq -r '.data.token')

curl -H "Authorization: Bearer $TOKEN" https://blackevil.cn/api/cycles

# é¢„æœŸç»“æœ: 200 OK å’Œè€ƒæ ¸å‘¨æœŸåˆ—è¡¨
# å¦‚æœä»æ˜¯ 500: éœ€è¦æ£€æŸ¥æ—¥å¿—æˆ–é‡å¯æœåŠ¡
```

### æ­¥éª¤ 3: æ‰§è¡Œæ•°æ®åº“ä¿®å¤è„šæœ¬

âš ï¸ **é‡è¦**: è¿™ä¸€æ­¥å¿…é¡»æ‰‹åŠ¨æ‰§è¡Œ

```bash
# 1. SSH ç™»å½•ç”Ÿäº§æœåŠ¡å™¨
ssh user@blackevil.cn

# 2. ä¸‹è½½ä¿®å¤è„šæœ¬
cd /tmp
wget https://raw.githubusercontent.com/CDUESTC-OpenAtom-Club/sism-backend/main/database/scripts/diagnose-and-fix-production.sql

# 3. æ‰§è¡Œä¿®å¤è„šæœ¬
# æ³¨æ„: æ›¿æ¢ä¸ºå®é™…çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯
psql -h localhost -U sism_user -d sism_db -f diagnose-and-fix-production.sql

# 4. æ£€æŸ¥è¾“å‡º
# è„šæœ¬ä¼šæ˜¾ç¤ºè¯Šæ–­ä¿¡æ¯å’Œä¿®å¤ç»“æœ
# ç¡®è®¤æ‰€æœ‰ç”¨æˆ·çš„å¯†ç çŠ¶æ€æ˜¾ç¤ºä¸º "âœ“ æ­£ç¡®"

# 5. é‡å¯åç«¯æœåŠ¡ï¼ˆå¦‚æœéœ€è¦ï¼‰
sudo systemctl restart sism-backend
```

### æ­¥éª¤ 4: éªŒè¯ä¿®å¤ç»“æœ

#### 4.1 æµ‹è¯•è€ƒæ ¸å‘¨æœŸ API

```bash
TOKEN=$(curl -s -X POST https://blackevil.cn/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"zhanlue","password":"123456"}' | jq -r '.data.token')

curl -H "Authorization: Bearer $TOKEN" https://blackevil.cn/api/cycles | jq
```

**é¢„æœŸç»“æœ**:
```json
{
  "code": 0,
  "message": "Success",
  "data": [
    {
      "cycleId": 4,
      "cycleName": "2026å¹´åº¦è€ƒæ ¸å‘¨æœŸ",
      "year": 2026,
      "startDate": "2026-01-01",
      "endDate": "2026-12-31",
      ...
    },
    ...
  ]
}
```

#### 4.2 æµ‹è¯•æ‰€æœ‰ç”¨æˆ·ç™»å½•

```bash
# æµ‹è¯• zhanlue
curl -X POST https://blackevil.cn/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"zhanlue","password":"123456"}' | jq

# æµ‹è¯• jiaowu
curl -X POST https://blackevil.cn/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"jiaowu","password":"123456"}' | jq

# æµ‹è¯• keyan (é‡ç‚¹éªŒè¯)
curl -X POST https://blackevil.cn/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"keyan","password":"123456"}' | jq

# æµ‹è¯• renshi
curl -X POST https://blackevil.cn/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"renshi","password":"123456"}' | jq

# æµ‹è¯• xuesheng
curl -X POST https://blackevil.cn/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"xuesheng","password":"123456"}' | jq
```

**é¢„æœŸç»“æœ**: æ‰€æœ‰ç”¨æˆ·éƒ½åº”è¿”å› 200 OK å’Œ JWT token

---

## å½“å‰æµ‹è¯•ç»“æœ

### æµ‹è¯•æ—¶é—´: 2026-01-28 13:55

| æµ‹è¯•é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| å‰ç«¯å¯è®¿é—® | âœ… PASS | 200 OK |
| åç«¯å¥åº·æ£€æŸ¥ | âœ… PASS | status: UP |
| ç»„ç»‡ API | âœ… PASS | 28 ä¸ªç»„ç»‡ |
| zhanlue ç™»å½• | âœ… PASS | ç™»å½•æˆåŠŸ |
| jiaowu ç™»å½• | âœ… PASS | ç™»å½•æˆåŠŸ |
| keyan ç™»å½• | âŒ FAIL | 401 æœªæˆæƒ (éœ€è¦æ‰§è¡Œæ•°æ®åº“è„šæœ¬) |
| è€ƒæ ¸å‘¨æœŸ API | âŒ FAIL | 500 é”™è¯¯ (éœ€è¦ç­‰å¾…éƒ¨ç½²æˆ–é‡å¯) |

---

## é—®é¢˜è¯Šæ–­

### é—®é¢˜ 1: è€ƒæ ¸å‘¨æœŸ API è¿”å› 500

**å¯èƒ½åŸå› **:
1. GitHub Actions è¿˜æœªå®Œæˆéƒ¨ç½²
2. æ–°çš„ JAR æ–‡ä»¶æœªä¸Šä¼ åˆ°æœåŠ¡å™¨
3. æœåŠ¡æœªé‡å¯ï¼Œä»åœ¨è¿è¡Œæ—§ä»£ç 
4. ç¼–è¯‘æˆ–è¿è¡Œæ—¶é”™è¯¯

**è¯Šæ–­æ­¥éª¤**:
```bash
# æ£€æŸ¥ JAR æ–‡ä»¶ä¿®æ”¹æ—¶é—´
ssh user@blackevil.cn "ls -lh /opt/sism/backend/sism-backend-1.0.0.jar"

# æ£€æŸ¥æœåŠ¡å¯åŠ¨æ—¶é—´
ssh user@blackevil.cn "sudo systemctl status sism-backend | grep Active"

# æ£€æŸ¥æœ€è¿‘çš„é”™è¯¯æ—¥å¿—
ssh user@blackevil.cn "sudo journalctl -u sism-backend -n 100 --no-pager | grep -i error"

# æ£€æŸ¥æ˜¯å¦æœ‰ AssessmentCycleController ç›¸å…³çš„æ—¥å¿—
ssh user@blackevil.cn "sudo journalctl -u sism-backend -n 100 --no-pager | grep -i cycle"
```

**è§£å†³æ–¹æ¡ˆ**:
1. ç­‰å¾… GitHub Actions å®Œæˆï¼ˆæ£€æŸ¥ Actions é¡µé¢ï¼‰
2. å¦‚æœ Actions å·²å®Œæˆä½†ä»æœ‰é—®é¢˜ï¼Œæ‰‹åŠ¨é‡å¯æœåŠ¡:
   ```bash
   ssh user@blackevil.cn "sudo systemctl restart sism-backend"
   ```
3. å¦‚æœä»æœ‰é—®é¢˜ï¼Œæ£€æŸ¥æ—¥å¿—å¹¶æŠ¥å‘Šé”™è¯¯

### é—®é¢˜ 2: keyan ç”¨æˆ·ç™»å½•å¤±è´¥

**åŸå› **: æ•°æ®åº“ä¿®å¤è„šæœ¬æœªæ‰§è¡Œ

**è§£å†³æ–¹æ¡ˆ**: æŒ‰ç…§"æ­¥éª¤ 3"æ‰§è¡Œæ•°æ®åº“ä¿®å¤è„šæœ¬

---

## å®Œæ•´éªŒè¯æ¸…å•

### éƒ¨ç½²éªŒè¯
- [ ] GitHub Actions åç«¯éƒ¨ç½²æˆåŠŸ
- [ ] GitHub Actions å‰ç«¯éƒ¨ç½²æˆåŠŸ
- [ ] åç«¯ JAR æ–‡ä»¶å·²æ›´æ–°
- [ ] åç«¯æœåŠ¡å·²é‡å¯
- [ ] å‰ç«¯æ–‡ä»¶å·²æ›´æ–°

### æ•°æ®åº“ä¿®å¤
- [ ] æ•°æ®åº“ä¿®å¤è„šæœ¬å·²ä¸‹è½½
- [ ] æ•°æ®åº“ä¿®å¤è„šæœ¬å·²æ‰§è¡Œ
- [ ] æ‰€æœ‰ç”¨æˆ·å¯†ç çŠ¶æ€æ­£ç¡®
- [ ] è€ƒæ ¸å‘¨æœŸæ•°æ®å®Œæ•´

### åŠŸèƒ½éªŒè¯
- [ ] å‰ç«¯ç½‘ç«™å¯è®¿é—®
- [ ] åç«¯å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] è€ƒæ ¸å‘¨æœŸ API è¿”å› 200
- [ ] è€ƒæ ¸å‘¨æœŸæ•°æ®æ­£ç¡®
- [ ] zhanlue ç”¨æˆ·ç™»å½•æˆåŠŸ
- [ ] jiaowu ç”¨æˆ·ç™»å½•æˆåŠŸ
- [ ] keyan ç”¨æˆ·ç™»å½•æˆåŠŸ
- [ ] renshi ç”¨æˆ·ç™»å½•æˆåŠŸ
- [ ] xuesheng ç”¨æˆ·ç™»å½•æˆåŠŸ
- [ ] ç»„ç»‡ API æ­£å¸¸
- [ ] æŒ‡æ ‡ API æ­£å¸¸

### æµè§ˆå™¨æµ‹è¯•
- [ ] ç™»å½•é¡µé¢æ­£å¸¸
- [ ] æ•°æ®çœ‹æ¿åŠ è½½æ­£å¸¸
- [ ] æŒ‡æ ‡åˆ—è¡¨åŠ è½½æ­£å¸¸
- [ ] æˆ˜ç•¥ä»»åŠ¡è§†å›¾æ­£å¸¸
- [ ] æ•°æ®æ¥è‡ªç”Ÿäº§æ•°æ®åº“
- [ ] é¡µé¢åˆ·æ–°æ•°æ®ä¿æŒ

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œ
1. â³ **æ£€æŸ¥ GitHub Actions çŠ¶æ€**
   - è®¿é—® Actions é¡µé¢
   - ç¡®è®¤éƒ¨ç½²æ˜¯å¦å®Œæˆ
   - å¦‚æœå¤±è´¥ï¼ŒæŸ¥çœ‹é”™è¯¯æ—¥å¿—

2. ğŸ”§ **æ‰§è¡Œæ•°æ®åº“ä¿®å¤**
   - SSH ç™»å½•æœåŠ¡å™¨
   - ä¸‹è½½å¹¶æ‰§è¡Œä¿®å¤è„šæœ¬
   - éªŒè¯ä¿®å¤ç»“æœ

3. ğŸ”„ **é‡å¯æœåŠ¡ï¼ˆå¦‚éœ€è¦ï¼‰**
   - å¦‚æœ Actions å·²å®Œæˆä½† API ä»æœ‰é—®é¢˜
   - æ‰‹åŠ¨é‡å¯åç«¯æœåŠ¡
   - ç­‰å¾…æœåŠ¡å¯åŠ¨å®Œæˆ

4. âœ… **é‡æ–°æµ‹è¯•**
   - æµ‹è¯•è€ƒæ ¸å‘¨æœŸ API
   - æµ‹è¯•æ‰€æœ‰ç”¨æˆ·ç™»å½•
   - æ›´æ–°éªŒè¯æŠ¥å‘Š

### åç»­æµ‹è¯•
1. ä½¿ç”¨æµè§ˆå™¨è¿›è¡Œå®Œæ•´åŠŸèƒ½æµ‹è¯•
2. æµ‹è¯•æ•°æ®æŒä¹…æ€§
3. æµ‹è¯•æƒé™æ§åˆ¶
4. ç¼–å†™æœ€ç»ˆéªŒè¯æŠ¥å‘Š

---

## è”ç³»ä¿¡æ¯

**æŠ€æœ¯æ”¯æŒ**:
- åç«¯å¼€å‘å›¢é˜Ÿ
- æ•°æ®åº“ç®¡ç†å‘˜
- DevOps å›¢é˜Ÿ

**ç´§æ€¥è”ç³»**:
- å¦‚éƒ¨ç½²å¤±è´¥æˆ–æ— æ³•ä¿®å¤ï¼Œç«‹å³è”ç³»æŠ€æœ¯è´Ÿè´£äºº

---

## ç›¸å…³æ–‡æ¡£

1. **ä¿®å¤æŠ¥å‘Š**: `docs/ç”Ÿäº§ç¯å¢ƒé—®é¢˜ä¿®å¤æŠ¥å‘Š-2026-01-28.md`
2. **ä¿®å¤è®¡åˆ’**: `docs/ç”Ÿäº§ç¯å¢ƒé—®é¢˜ä¿®å¤è®¡åˆ’-2026-01-28.md`
3. **æµ‹è¯•æ€»ç»“**: `docs/ç”Ÿäº§ç¯å¢ƒæµ‹è¯•æ€»ç»“-2026-01-28.md`
4. **æ•°æ®åº“è„šæœ¬**: 
   - `sism-backend/database/scripts/diagnose-and-fix-production.sql`
   - `sism-backend/database/scripts/fix-keyan-user.sql`

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2026-01-28 13:55 UTC+8  
**æœ€åæ›´æ–°**: 2026-01-28 13:55 UTC+8  
**çŠ¶æ€**: ğŸŸ¡ ç­‰å¾…æ‰‹åŠ¨æ“ä½œå®Œæˆ
